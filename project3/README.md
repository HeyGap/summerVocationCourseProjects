# Project 3: 基于Circom的零知识证明系统

## 项目概述

Project 3 是一个基于 Circom 电路语言的零知识证明系统实现项目，专注于密码学哈希函数的零知识应用。本项目包含了 Poseidon2 哈希算法的完整 Circom 实现以及基于 Groth16 的零知识证明生成与验证系统。

## 技术架构

### 核心技术栈
- **电路设计语言**: Circom 2.0.x
- **零知识证明系统**: Groth16
- **密码学库**: snarkjs 0.7.x
- **椭圆曲线**: BN254 (254-bit prime field)
- **开发环境**: Node.js + npm

### 项目结构
```
project3/
├── circom/                     # Circom编译器源码
│   ├── Cargo.toml             # Rust项目配置
│   ├── circom/                # 核心编译器实现
│   ├── compiler/              # 编译器逻辑
│   ├── constraint_generation/ # 约束生成
│   ├── parser/                # 语法解析器
│   └── target/                # 编译输出
│
├── poseidon2/                  # Poseidon2哈希零知识证明系统
│   ├── circuits/              # Circom电路实现
│   │   ├── simple_poseidon2.circom      # 简化版实现(96约束)
│   │   ├── poseidon2.circom             # 完整版实现  
│   │   ├── standard_poseidon2.circom    # 标准参数实现
│   │   └── poseidon2_variants.circom    # 变体实现
│   │
│   ├── js/                    # JavaScript工具链
│   │   ├── test.js            # 核心测试脚本
│   │   ├── verify.js          # 验证工具
│   │   └── benchmark.js       # 性能基准测试
│   │
│   ├── build/                 # 编译与证明输出
│   │   ├── *.r1cs             # R1CS约束系统
│   │   ├── *_js/              # WASM见证生成器
│   │   ├── *.ptau             # Powers of Tau文件
│   │   ├── *.zkey             # 证明/验证密钥
│   │   ├── proof.json         # 零知识证明
│   │   └── verification_key.json # 验证密钥
│   │
│   ├── package.json           # 项目依赖配置
│   ├── input.json             # 测试输入数据
│   ├── demo.sh                # 演示脚本
│   └── README.md              # 详细技术文档
│
└── README.md                   # 本文件
```

## 功能特性

### 1. Poseidon2 哈希算法实现

**技术参数:**
- 哈希函数: Poseidon2
- 参数组合: (n,t,d) = (256,3,5)
  - n=256: 基于BN254椭圆曲线的256位有限域
  - t=3: 状态宽度为3个字段元素
  - d=5: S-box指数为5 (x^5非线性变换)
- 轮数配置: 8轮 (2全轮 + 4偏轮 + 2全轮)

**电路实现:**
- 约束优化: 简化版仅96个约束 (48线性 + 48非线性)
- 模块化设计: SBox、线性层、全轮/偏轮独立实现
- 多版本支持: 提供简化版、标准版、完整版等多种实现

### 2. 零知识证明系统

**证明方案:**
- 证明系统: Groth16 (简洁非交互式零知识论证)
- 私有输入: 哈希原象 (2个字段元素)
- 公开输入: Poseidon2哈希值
- 证明声明: "证明者知道某个原象，其Poseidon2哈希值等于公开的哈希值"

**安全保证:**
- 零知识性: 证明过程不泄露原象信息
- 可靠性: 无法伪造不存在原象的证明
- 简洁性: 固定大小证明 (~128字节)

### 3. 完整工具链

**开发工具:**
- 自动化编译脚本 (npm run compile)
- Trusted Setup 自动化 (Powers of Tau + 电路特定设置)
- 见证生成与证明创建
- 证明验证与系统测试
- 性能基准测试与分析

## 安装与使用

### 环境要求
```bash
Node.js >= 16.0.0
npm >= 8.0.0
Circom >= 2.0.0
```

### 快速开始

1. **项目初始化**
```bash
cd project3/poseidon2
npm install
```

2. **编译电路**
```bash
npm run compile
```

3. **执行Trusted Setup**
```bash
npm run setup          # Powers of Tau仪式
npm run setup-circuit  # 电路特定参数生成
```

4. **完整测试流程**
```bash
npm run test           # 生成测试数据并验证
npm run witness        # 创建见证
npm run prove          # 生成零知识证明
npm run verify         # 验证证明有效性
```

### 可用脚本

| 命令 | 功能描述 |
|------|----------|
| `npm run compile` | 编译简化版Poseidon2电路 |
| `npm run compile-full` | 编译完整版Poseidon2电路 |
| `npm run setup` | 执行Powers of Tau trusted setup |
| `npm run setup-circuit` | 生成电路特定证明/验证密钥 |
| `npm run witness` | 从输入数据生成见证 |
| `npm run prove` | 创建Groth16零知识证明 |
| `npm run verify` | 验证证明的有效性 |
| `npm run test` | 执行完整测试流程 |
| `npm run benchmark` | 运行性能基准测试 |
| `npm run full-test` | 端到端完整测试 |
| `npm run clean` | 清理编译输出 |

## 技术创新

### 1. 高度优化的电路设计
- **约束最小化**: 通过算法优化将约束数量降低至96个
- **模块化架构**: 清晰的组件分离便于维护和扩展
- **多版本实现**: 支持不同安全级别和性能需求

### 2. 完整的零知识证明工作流
- **自动化设置**: 简化复杂的trusted setup过程
- **端到端验证**: 从电路编译到证明验证的完整流程
- **性能监控**: 详细的基准测试和性能分析

### 3. 生产级工具链
- **标准化接口**: 统一的npm scripts管理
- **错误处理**: 完善的错误检测和用户提示
- **扩展性**: 支持多种参数配置和算法变体

## 性能指标

### 电路性能
- **约束数量**: 96 (简化版) / 1000+ (完整版)
- **编译时间**: < 1秒 (简化版)
- **见证生成**: 毫秒级
- **内存使用**: < 100MB

### 证明性能  
- **证明生成**: < 5秒 (简化版)
- **证明大小**: ~128字节 (Groth16固定)
- **验证时间**: < 50ms
- **验证密钥**: ~2KB

### 测试结果
```
测试用例: ['123456789', '987654321']
哈希输出: 21211605167783748478198991034217750710666889077103304402041408732752963186065
证明状态: ✅ 验证通过 (snarkJS: OK!)
约束统计: 96约束 (48线性 + 48非线性)
```

## 安全考虑

### 1. 密码学安全
- **标准曲线**: 使用经过验证的BN254椭圆曲线
- **Trusted Setup**: 完整的Powers of Tau仪式
- **随机性**: 安全的随机数生成

### 2. 实现安全
- **约束完整性**: 完整的R1CS约束验证
- **输入验证**: 严格的输入数据校验
- **测试覆盖**: 全面的功能和安全测试

### 3. 使用限制
- **学术研究**: 当前实现主要用于教育和研究目的
- **生产部署**: 生产环境使用需要额外的安全审计
- **参数选择**: 部分参数为简化版本，实际应用需调整

## 扩展方向

### 1. 算法扩展
- 支持更多Poseidon2参数组合 (t=2,4,8...)
- 实现其他零知识友好哈希函数 (MiMC, Rescue等)
- 批量哈希和树结构支持

### 2. 系统集成
- 与其他ZK应用集成 (DeFi, 身份认证等)
- 支持更多证明系统 (PLONK, STARK等)
- 跨链零知识证明应用

### 3. 性能优化
- GPU加速证明生成
- 并行化见证计算
- 更高效的约束系统设计

## 学术价值

### 1. 教育意义
- **完整案例**: 展示零知识证明的完整工作流程
- **最佳实践**: 演示工程级的Circom开发规范
- **技术文档**: 详细的技术实现和设计思路

### 2. 研究基础
- **算法实验**: 为Poseidon2算法研究提供实验平台
- **性能基准**: 为零知识证明性能研究提供参考数据
- **扩展框架**: 为其他密码学算法实现提供模板

## 贡献指南

### 开发环境
```bash
git clone <repository>
cd project3/poseidon2
npm install
npm run compile
npm run test
```

### 代码规范
- 遵循Circom官方编码规范
- 提供充分的代码注释和文档
- 包含完整的测试用例
